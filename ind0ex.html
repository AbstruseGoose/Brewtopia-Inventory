<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Brewtopia Inventory</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2/dist/quagga.min.js"></script>

<style>
/* ==== styles unchanged for stability ==== */
:root {
  color-scheme: dark;
  --bg-body:#0d1117;
  --bg-card:rgba(22,27,34,.92);
  --border-subtle:#30363d;
  --text-primary:#e6edf3;
  --text-muted:#8b949e;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI,sans-serif;
  background:#0d1117;
  color:var(--text-primary);
  padding:16px;
}
.card{
  background:var(--bg-card);
  border-radius:16px;
  padding:16px;
  border:1px solid var(--border-subtle);
  margin-bottom:16px;
}
.hidden{display:none}
.btn{
  padding:8px 14px;
  border-radius:999px;
  border:none;
  cursor:pointer;
  background:#238636;
  color:white;
}
.btn.secondary{background:#21262d}
.btn.danger{background:#b91c1c}
input,select,textarea{
  width:100%;
  background:#010409;
  color:var(--text-primary);
  border:1px solid #30363d;
  border-radius:8px;
  padding:8px;
}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border-bottom:1px solid #21262d;padding:6px}
.stock-zero{background:rgba(127,29,29,.35)}
.stock-low{background:rgba(180,83,9,.25)}
.pill{
  padding:2px 6px;
  border-radius:999px;
  font-size:11px;
  border:1px solid #30363d;
  margin-left:6px;
}
</style>
</head>

<body>
<div class="app">

<!-- LOGIN -->
<div id="loginCard" class="card">
  <h2>Brewtopia Inventory</h2>
  <input id="pinInput" type="password" placeholder="PIN">
  <button id="loginBtn" class="btn">Unlock</button>
  <div id="loginStatus"></div>
</div>

<!-- MAIN -->
<div id="mainArea" class="hidden">

<div class="card">
  <button class="btn" id="btnReceive">Receive</button>
  <button class="btn secondary" id="btnInventory">Inventory</button>
</div>

<!-- INVENTORY -->
<div id="inventoryCard" class="card hidden">
  <table>
    <thead>
      <tr><th>Item</th><th>UPC</th><th>Qty</th><th>Par</th><th></th></tr>
    </thead>
    <tbody id="inventoryBody"></tbody>
  </table>
</div>

</div>

<!-- MODAL -->
<div id="itemModalBackdrop" class="hidden">
<div class="card">
  <h3 id="modalTitle">Item</h3>

  <label>UPC</label>
  <input id="modalUpc" readonly>

  <label>Name</label>
  <input id="modalName">

  <label>Quantity</label>
  <input id="modalQty" type="number">

  <label>Par</label>
  <input id="modalPar" type="number">

  <label>
    <input type="checkbox" id="modalActive" checked>
    Active item (track stock levels)
  </label>

  <button class="btn" id="modalSaveBtn">Save</button>
  <button class="btn secondary" id="modalCancelBtn">Cancel</button>
</div>
</div>

</div>

<script>
/* ==== CONFIG ==== */
const PIN="6251";
const STORAGE_KEY="brewtopia_inventory_v1";

/* ==== STATE ==== */
let inventory={};
let editingUpc=null;

/* ==== ELEMENTS ==== */
const $=id=>document.getElementById(id);
const loginCard=$("loginCard");
const mainArea=$("mainArea");
const inventoryBody=$("inventoryBody");

/* ==== LOGIN ==== */
$("loginBtn").onclick=()=>{
  if($("pinInput").value!==PIN){
    $("loginStatus").textContent="Wrong PIN";
    return;
  }
  loginCard.classList.add("hidden");
  mainArea.classList.remove("hidden");
  loadInventory();
  renderInventory();
};

/* ==== STORAGE ==== */
function loadInventory(){
  inventory=JSON.parse(localStorage.getItem(STORAGE_KEY)||"{}");
}
function saveInventory(){
  localStorage.setItem(STORAGE_KEY,JSON.stringify(inventory));
}

/* ==== INVENTORY ==== */
function renderInventory(){
  inventoryBody.innerHTML="";
  Object.values(inventory).forEach(item=>{
    const tr=document.createElement("tr");
    const isActive=item.active!==false;

    if(isActive){
      if(item.qty===0)tr.classList.add("stock-zero");
      else if(item.par>0 && item.qty<item.par)tr.classList.add("stock-low");
    }

    tr.innerHTML=`
      <td>
        <strong>${item.name}</strong>
        ${!isActive?'<span class="pill">Inactive</span>':""}
      </td>
      <td>${item.upc}</td>
      <td>${item.qty}</td>
      <td>${item.par}</td>
      <td><button class="btn secondary">Edit</button></td>
    `;

    tr.querySelector("button").onclick=()=>openEdit(item.upc);
    inventoryBody.appendChild(tr);
  });
}

/* ==== MODAL ==== */
function openEdit(upc){
  const item=inventory[upc];
  editingUpc=upc;
  $("modalUpc").value=upc;
  $("modalName").value=item.name;
  $("modalQty").value=item.qty;
  $("modalPar").value=item.par;
  $("modalActive").checked=item.active!==false;
  $("itemModalBackdrop").classList.remove("hidden");
}

$("modalSaveBtn").onclick=()=>{
  const upc=$("modalUpc").value;
  inventory[upc]={
    ...inventory[upc],
    name:$("modalName").value,
    qty:Number($("modalQty").value),
    par:Number($("modalPar").value),
    active:$("modalActive").checked
  };
  saveInventory();
  renderInventory();
  $("itemModalBackdrop").classList.add("hidden");
};

$("modalCancelBtn").onclick=()=>{
  $("itemModalBackdrop").classList.add("hidden");
};

/* ==== DEMO DATA (REMOVE IF NOT NEEDED) ==== */
if(!localStorage.getItem(STORAGE_KEY)){
  inventory={
    "123456789012":{
      upc:"123456789012",
      name:"Vanilla Syrup",
      qty:0,
      par:2,
      active:false
    }
  };
  saveInventory();
}
</script>
</body>
</html>
